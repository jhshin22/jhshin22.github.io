<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>OX 퀴즈 인증</title>
<style>
    body {
        font-family: "Noto Sans KR", sans-serif;
        margin: 0;
        background-color: #f9f9f9;
        text-align: center;
        font-size: 18px;
        padding: 20px;
    }
    .quiz-box {
        max-width: 600px;
        margin: auto;
        background: white;
        border-radius: 10px;
        padding: 20px;
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    .question-text {
        font-size: 20px;
        margin-bottom: 20px;
    }
    button {
        font-size: 20px;
        padding: 15px 25px;
        border-radius: 10px;
        margin: 10px;
        border: none;
        background-color: #1a73e8;
        color: white;
        cursor: pointer;
    }
    button:hover {
        background-color: #0c5cc2;
    }
    #explanation {
        margin-top: 15px;
        font-size: 18px;
        color: #333;
    }
    #smsBtn, #retryBtn {
        display: none;
        background-color: #4CAF50;
    }
    @media (max-width: 600px) {
        body {
            font-size: 20px;
        }
        button {
            font-size: 22px;
            padding: 18px 30px;
            width: 80%;
        }
        .question-text {
            font-size: 22px;
            line-height: 1.5em;
        }
    }
</style>
</head>
<body>

<div class="quiz-box">
    <h2>OX 퀴즈</h2>
    <div id="question" class="question-text"></div>
    <div>
        <button onclick="checkAnswer('O')">O</button>
        <button onclick="checkAnswer('X')">X</button>
    </div>
    <div id="explanation"></div>
    <button id="nextBtn" style="display:none;" onclick="nextQuestion()">다음 문제</button>
    <button id="retryBtn" onclick="retryQuiz()">다시하기</button>
    <button id="smsBtn" onclick="sendSMS()">인증코드 전송</button>
</div>

<script>
const quizData = [
    { q: "교보생명은 1958년에 설립되었다.", a: "O", exp: "정답입니다! 교보생명은 1958년에 설립되었습니다." },
    { q: "보험계약대출은 신용점수에 영향을 주지 않는다.", a: "O", exp: "맞아요. 보험계약대출은 담보대출 성격이므로 신용점수에 직접 영향이 없습니다." },
    { q: "DSR 규제는 모든 대출에 동일하게 적용된다.", a: "X", exp: "아닙니다. 정책금융, 일부 담보대출 등은 제외되기도 합니다." },
    { q: "신용대출은 무조건 금리가 높다.", a: "X", exp: "아니요. 신용도, 우대조건 등에 따라 낮을 수도 있습니다." },
    { q: "보험설계사는 대출상품을 취급할 수 있다.", a: "O", exp: "맞습니다. 일정 조건을 갖춘 설계사는 대출상품 안내가 가능합니다." }
];

let currentQuestion = 0;
let correctCount = 0;
const secretSalt = "KyoboSecretKey2025"; // 제작자만 아는 비밀키

function loadQuestion() {
    document.getElementById("question").innerText = quizData[currentQuestion].q;
    document.getElementById("explanation").innerText = "";
    document.getElementById("nextBtn").style.display = "none";
}

function checkAnswer(answer) {
    let exp = quizData[currentQuestion].exp;
    if (answer === quizData[currentQuestion].a) {
        correctCount++;
        document.getElementById("explanation").innerHTML = "✅ 정답!<br>" + exp;
    } else {
        document.getElementById("explanation").innerHTML = "❌ 오답!<br>" + exp;
    }
    document.getElementById("nextBtn").style.display = "inline-block";
}

function nextQuestion() {
    currentQuestion++;
    if (currentQuestion < quizData.length) {
        loadQuestion();
    } else {
        endQuiz();
    }
}

function endQuiz() {
    if (correctCount === quizData.length) {
        let code = generateCode();
        document.getElementById("question").innerText = "🎉 모든 문제를 맞혔습니다! 인증코드: " + code;
        document.getElementById("smsBtn").style.display = "inline-block";
    } else {
        document.getElementById("question").innerText = "😢 일부 문제를 틀렸습니다. 다시 시도해주세요.";
        document.getElementById("retryBtn").style.display = "inline-block";
    }
    document.querySelectorAll("button[onclick^='checkAnswer']").forEach(btn => btn.style.display = "none");
    document.getElementById("nextBtn").style.display = "none";
}

function retryQuiz() {
    currentQuestion = 0;
    correctCount = 0;
    document.querySelectorAll("button[onclick^='checkAnswer']").forEach(btn => btn.style.display = "inline-block");
    document.getElementById("retryBtn").style.display = "none";
    document.getElementById("smsBtn").style.display = "none";
    loadQuestion();
}

function generateCode() {
    let now = new Date();
    let timeStr = `${now.getFullYear()}${now.getMonth()+1}${now.getDate()}${now.getHours()}${now.getMinutes()}`;
    let raw = secretSalt + timeStr;
    let hash = sha256(raw).substring(0, 8);
    return hash;
}

function sendSMS() {
    let code = generateCode();
    let ua = navigator.userAgent.toLowerCase();
    let phoneNumber = "01012345678";
    if (/iphone|ipad|ipod/.test(ua)) {
        window.location.href = `sms:${phoneNumber}&body=${code}`;
    } else {
        window.location.href = `sms:${phoneNumber}?body=${code}`;
    }
}

// SHA-256 함수
function sha256(ascii) {
    const buffer = new TextEncoder().encode(ascii);
    return crypto.subtle.digest("SHA-256", buffer).then(hash => {
        return hex(hash);
    });
}
function hex(buffer) {
    const hexCodes = [];
    const view = new DataView(buffer);
    for (let i = 0; i < view.byteLength; i += 4) {
        const value = view.getUint32(i);
        const stringValue = value.toString(16);
        const padding = '00000000';
        const paddedValue = (padding + stringValue).slice(-padding.length);
        hexCodes.push(paddedValue);
    }
    return hexCodes.join("");
}
// Promise 대응
function generateCode() {
    let now = new Date();
    let timeStr = `${now.getFullYear()}${now.getMonth()+1}${now.getDate()}${now.getHours()}${now.getMinutes()}`;
    let raw = secretSalt + timeStr;
    let hashPromise = sha256(raw);
    return "로딩중...";
}
</script>

<script>
// SHA-256 동기 처리 버전 (Promise 없이)
function sha256Sync(str) {
    const utf8 = new TextEncoder().encode(str);
    const hashBuffer = new Uint8Array(crypto.subtle.digestSync ? crypto.subtle.digestSync("SHA-256", utf8) : []);
    return Array.from(hashBuffer).map(b => b.toString(16).padStart(2, "0")).join("");
}
function generateCode() {
    let now = new Date();
    let timeStr = `${now.getFullYear()}${now.getMonth()+1}${now.getDate()}${now.getHours()}${now.getMinutes()}`;
    let raw = secretSalt + timeStr;
    return sha256Sync(raw).substring(0, 8);
}
</script>

<script>
loadQuestion();
</script>
</body>
</html>
